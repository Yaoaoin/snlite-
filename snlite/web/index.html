<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SNLite v0.5.3</title>
  <link rel="stylesheet" href="/static/style.css?v=0.5.3" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">SN</div>
        <div>
          <div class="title">SNLite</div>
          <div class="sub">v0.5.3 · Local GenAI</div>
        </div>
      </div>

      <section class="panel">
        <div class="panel-title">
          Model
          <span class="help" data-tip="选择后端与模型。图片输入仅对多模态模型生效。Thinking trace 仅对支持 thinking 的模型生效。">?</span>
        </div>
        <div class="row">
          <select id="providerSelect"></select>
        </div>
        <div class="row">
          <select id="modelSelect"></select>
        </div>
        <div class="row">
          <button id="btnRefresh">Refresh</button>
          <button id="btnLoad" class="primary">Load</button>
          <button id="btnUnload">Unload</button>
        </div>
        <div id="modelStatus" class="hint"></div>
      </section>

      <section class="panel">
        <div class="panel-title">
          Sessions
          <span class="help" data-tip="每个会话是一条独立聊天。第一轮对话完成后会根据首条用户消息自动生成标题。">?</span>
        </div>
        <div class="row">
          <button id="btnNewSession" class="primary">New</button>
          <button id="btnRenameSession">Rename</button>
          <button id="btnDeleteSession" class="danger">Delete</button>
        </div>
        <div id="sessions" class="sessions"></div>
        <div class="row">
          <button id="btnExport">Export .md</button>
        </div>
      </section>

      <section class="panel">
        <div class="panel-title">
          Thinking (Ollama native)
          <span class="help" data-tip="stream 会分离 message.thinking 与 message.content。Show trace 只控制是否展示，不影响模型是否思考。">?</span>
        </div>

        <div class="row">
          <label class="small" style="flex:1;">
            Think mode
            <span class="help" data-tip="Auto：不显式传 think（使用模型默认）。On/Off：对大多数模型是 true/false。GPT-OSS 需要 low/medium/high。">?</span>
          </label>
        </div>
        <div class="row">
          <select id="thinkMode">
            <option value="auto">auto (default)</option>
            <option value="on">on</option>
            <option value="off">off</option>
            <option value="low">low (gpt-oss)</option>
            <option value="medium">medium (gpt-oss)</option>
            <option value="high">high (gpt-oss)</option>
          </select>
        </div>

        <div class="row switch-row" style="margin-top:6px;">
          <label class="switch">
            <input id="showTrace" type="checkbox" />
            <span class="slider"></span>
          </label>
          <div class="switch-text">
            <div class="switch-title">
              Show trace in workspace
              <span class="help" data-tip="开启后：右侧工作区显示 thinking token 流。关闭后：仍可使用 think，但 UI 不展示。">?</span>
            </div>
            <div class="hint">UI only.</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-title">
          UI
          <span class="help" data-tip="自动滚动：流式生成时跟随到底部；当你手动向上滚动阅读旧消息时，会暂停自动滚动，避免抢控制。">?</span>
        </div>
        <div class="row switch-row">
          <label class="switch">
            <input id="autoScroll" type="checkbox" checked />
            <span class="slider"></span>
          </label>
          <div class="switch-text">
            <div class="switch-title">Auto-scroll during streaming</div>
            <div class="hint">Pauses when you scroll up.</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-title">
          Params
          <span class="help" data-tip="这些参数会影响生成风格与随机性。不同模型支持程度不同。">?</span>
        </div>

        <div class="param">
          <div class="param-head">
            <span>temperature <span class="help" data-tip="随机性/发散度。越高越有创意但更不稳定；越低越严谨但更保守。">?</span></span>
            <span class="badge" id="tempVal"></span>
          </div>
          <input id="temperature" class="range" type="range" min="0" max="2" step="0.05" value="0.7" />
        </div>

        <div class="param">
          <div class="param-head">
            <span>top_p <span class="help" data-tip="核采样阈值。越低越保守；与 temperature 共同作用。">?</span></span>
            <span class="badge" id="topPVal"></span>
          </div>
          <input id="top_p" class="range" type="range" min="0" max="1" step="0.05" value="0.9" />
        </div>

        <div class="param-grid">
          <div>
            <label class="small">max tokens (num_predict)
              <span class="help" data-tip="最大输出 token 数（Ollama: num_predict）。越大越长，但更慢、更吃资源。">?</span>
            </label>
            <input id="num_predict" type="number" min="16" max="8192" step="16" value="512" />
          </div>
          <div>
            <label class="small">repeat_penalty
              <span class="help" data-tip="重复惩罚。提高可减少复读，但过高可能导致语言不自然。">?</span>
            </label>
            <input id="repeat_penalty" type="number" min="0.8" max="2.0" step="0.05" value="1.1" />
          </div>
        </div>
      </section>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="top-left">
          <div class="pill" id="loadedBadge">No model</div>
          <div class="pill subtle" id="stageBadge">Idle</div>
        </div>
        <div class="top-right">
          <button id="btnCopyLast" title="Copy last assistant message">Copy last</button>
          <button id="btnRegen" title="Regenerate last assistant message">Regenerate</button>
          <button id="btnStop" class="danger" disabled>Stop</button>
          <button id="btnClear" title="Clear UI (does not delete session)">Clear UI</button>
        </div>
      </header>

      <section class="chat" id="chatScroll">
        <div class="system-card">
          <div class="system-head">
            <div class="system-title">
              System prompt（前置提示词）
              <span class="help" data-tip="只在本次发送时拼到消息最前面，不自动写入会话历史。适合定义角色、规则、输出格式。">?</span>
            </div>
            <div class="hint">只在当前发送时生效，不会自动写入历史。建议用来定义角色、规则、语气。</div>
          </div>
          <textarea id="systemText" placeholder="例如：你是一个严谨的助教。回答用要点，必要时给例子。"></textarea>
        </div>

        <div id="messages" class="messages"></div>
      </section>

      <footer class="composer">
        <div class="composer-left">
          <div class="composer-label">
            Message（对话输入）
            <span class="help" data-tip="Ctrl/⌘ + Enter 发送。支持附带 1 张图片 + 多个文件（pdf/docx/txt/md）。文件会被解析为文本摘录注入到本次提问中。">?</span>
          </div>

          <div class="attach">
            <input id="imageFile" type="file" accept="image/*" style="display:none;" />
            <button id="btnAttach" class="ghost">Attach Image</button>
            <button id="btnRemoveImage" class="ghost" style="display:none;">Remove Image</button>

            <input id="docFiles" type="file" accept=".pdf,.docx,.txt,.md,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,text/markdown" multiple style="display:none;" />
            <button id="btnAttachFiles" class="ghost">Attach Files</button>
          </div>

          <div id="imageInfo" class="attach-info" style="display:none;">
            <img id="imagePreview" class="thumb" alt="preview" />
            <div class="attach-meta">
              <div id="imageName" class="attach-name"></div>
              <div class="hint" id="imageHint">Image will be sent with your next message.</div>
            </div>
          </div>

          <div id="fileList" class="file-list" style="display:none;"></div>

          <textarea id="input" rows="2" placeholder="Type your message…  (Ctrl/⌘ + Enter to send)"></textarea>
        </div>
        <button id="btnSend" class="primary">Send</button>
      </footer>
    </main>

    <aside class="workspace" id="workspace">
      <div class="workspace-head">
        <div class="workspace-title">
          Thinking workspace
          <span class="help" data-tip="显示模型推理 trace（message.thinking）。仅供调试；不写入会话历史。">?</span>
        </div>
        <div class="workspace-actions">
          <button id="btnWsClear" class="ghost">Clear</button>
          <button id="btnWsHide" class="ghost">Hide</button>
        </div>
      </div>
      <div class="hint" style="margin:0 0 8px 0;">
        This panel shows streaming <b>thinking</b> tokens (Ollama native). It may be incomplete or inaccurate.
      </div>
      <pre id="wsText" class="workspace-text"></pre>
    </aside>
  </div>

  <script src="/static/app.js?v=0.5.3"></script>
</body>
</html>